<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="model.js"></script>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        th {
            background-color: blueviolet;
            color: whitesmoke;
        }

        table {
            width: 400px;
        }

        td {
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="app">
    </div>


    <script>

        const Task = {
            text: '',
            doneDate: null,
            responsible: 'Kenneth',
            editMode: false,
        };



        function updateView() {
            document.getElementById('app').innerHTML = /*HTML*/`
            <table>
            <thead>
                <th>To do</th>
                <th>Done date</th>
                <th>Responsible</th>
                <th>Done</th>
                <th>Edit</th>
                <th>Delete</th>
            </thead>
              ${toDoListHtml()}
            </table><br/>
            <input id="taskInput"  type="text">
            <button onclick="addTask()">Add task</button>
            `
        }
        updateView();

        function toDoListHtml() {
            let html = ``
            for (let index = 0; index < model.length; index++) {
                html += /*HTML*/`
                <tr class="toDoTableRow">
                   ${taskRowHtml(index)}
                    <td><input 
                        onclick=toDoComplete(${index}) 
                        type="checkbox" 
                        ${model[index].doneDate ? "checked" : ''}
                        /></td>
                    <td onclick="toggleEditMode(${index})" style="cursor:pointer">âœŽ</td>
                    <td onclick="deleteTask(${index})" style="cursor:pointer">ðŸ—‘</td>
                </tr>
                `
            }

            return html
        }

        function toDoComplete(index) {
            const today = new Date().toLocaleDateString().slice(0, 4);
            model[index].doneDate = typeof (model[index].doneDate) == 'string' ? null : today
            updateView();
        }

        function deleteTask(index) {
            model.splice(index, 1);
            updateView();
        }

        function addTask() {
            let text = document.getElementById('taskInput').value.trim();
            if (!text) return;
            model.push({ ...Task, text });
            updateView();
        }

        function toggleEditMode(index) {
            model[index].editMode = !model[index].editMode;
            updateView();
        }

        function taskRowHtml(index) {
            let html = ''
            if (model[index].editMode) {
                html =
                /*HTML*/`
                <td><input value="${model[index].text}" type="text" /></td>
                <td><input value="${model[index].doneDate}" type="text" /></td>
                <td><input value ="${model[index].responsible}"type="text"></td>
                `
            }
            else {
                html = /*HTML*/`
                    <td>${model[index].text}</td>
                    <td>${model[index].doneDate}</td>
                    <td>${model[index].responsible}</td>
                    `
            }
            return html;
        }


    </script>
</body>

</html>