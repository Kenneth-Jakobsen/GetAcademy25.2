<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="model.js"></script>
  <style>
    table,
    th,
    td {
      border: 1px solid black;
      border-collapse: collapse;
    }

    th {
      background-color: blueviolet;
      color: whitesmoke;
    }

    table {
      width: 400px;
    }

    td {
      text-align: center;
    }
  </style>
</head>

<body>
  <div id="app">
  </div>


  <script>


    function updateView() {
      document.getElementById('app').innerHTML = /*HTML*/`
    <div style="
      max-width: 750px;
      margin: 40px auto;
      font-family: system-ui, sans-serif;
      background: #fafafa;
      padding: 24px 32px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    ">
      <h2 style="margin-bottom: 20px; text-align:center;">üìù To-Do List</h2>

      <table style="
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 24px;
      ">
        <thead>
          <tr style="background-color: #f2f2f2; border-bottom: 2px solid #ddd;">
            <th style="padding: 10px; text-align:left;">To do</th>
            <th style="padding: 10px; text-align:left; cursor:pointer;" onclick="sortByDate()">Done date ‚¨ç</th>
            <th style="padding: 10px; text-align:left;">Responsible</th>
            <th style="padding: 10px;">Done</th>
            <th style="padding: 10px;">Edit</th>
            <th style="padding: 10px;">Delete</th>
          </tr>
        </thead>
        <tbody>
          ${toDoListHtml()}
        </tbody>
      </table>

      <div style="
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: space-between;
        align-items: center;
      ">
        <input  
          oninput="model.inputs.newTask.text=this.value"
          type="text" 
          placeholder="Write task here"
          style="
            flex: 2;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
          "
        >
        <input  
          oninput="model.inputs.newTask.responsible=this.value"
          type="text"
          placeholder="Responsible"
          style="
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
          "
        >
        <button 
          onclick="addTask()"
          style="
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 16px;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
          "
          onmouseover="this.style.background='#43a047'"
          onmouseout="this.style.background='#4CAF50'"
        >
          ‚ûï Add task
        </button>

        <select
          id="filterSelect"
          style="
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 15px;
            background-color: white;
            cursor: pointer;
          "
          onchange="model.inputs.filterByName=this.value;"
        >
          <option value="${model.inputs.filterByName}">Filter by name</option>
          <option>All</option>
          <option>Kenneth</option>
          <option>Anna</option>
          <option>Jonas</option>
          <option>Maja</option>
          <option>Eline</option>
          <option>Per</option>
          <option>Sara</option>
          <option>Lina</option>
        </select>
      </div>
    </div>
  `;
    }


    updateView();

    function toDoListHtml() {
      let html = ``
      let tasks = updateTasksToShow();
      for (let index = 0; index < tasks.length; index++) {
        html += /*HTML*/`
                <tr class="toDoTableRow">
                   ${taskRowHtml(index)}
                    <td><input 
                        onclick=toggleDone(${index}) 
                        type="checkbox" 
                        ${model.tasks[index].doneDate ? "checked" : ''}
                        /></td>
                    <td onclick="toggleEditMode(${index})" style="cursor:pointer">‚úé</td>
                    <td onclick="deleteTask(${index})" style="cursor:pointer">üóë</td>
                </tr>
                `
      }
      return html
    }

    function updateTasksToShow() {
      let currentPage = 1;
      const pageSize = 10;
      let start = (currentPage - 1) * pageSize;
      let end = start + pageSize;
      currentPageTasks = model.tasks.slice(start, end)
      return currentPageTasks
    }

    function toggleDone(index) {
      const today = new Date().toLocaleDateString('no-NO').slice(0, 4);
      const task = model.tasks[index];
      task.doneDate = task.doneDate ? null : today;
      updateView();
    }

    function deleteTask(index) {
      model.tasks.splice(index, 1);
      updateView();
    }

    function filterByName(name) {
      console.log(name)
    }

    function addTask() {
      const { text, responsible } = model.inputs.newTask;
      if (!text.trim()) return alert("Please write a task!");
      model.tasks.push({
        text: text.trim(),
        doneDate: null,
        responsible: responsible.trim() || 'Someone',
        editMode: false,
      });
      model.inputs.newTask.text = '';
      model.inputs.newTask.responsible = '';
      updateView();
    }

    function toggleEditMode(index) {
      model.tasks[index].editMode = !model.tasks[index].editMode;
      updateView();
    }


    function sortByDate() {
      model.tasks.sort((a, b) => new Date(a.doneDate) - new Date(b.doneDate))
      updateView();
    }

    function taskRowHtml(index) {
      let html = ''
      const filteredTasks = model.tasks.filter(task => task.responsible === model.inputs.filterByName);
      let tasks = model.tasks[index]
      if (tasks.editMode) {
        html =
                /*HTML*/`
                <td><input 
                    oninput="model.tasks[${index}].text=this.value" 
                    value="${tasks.text}" 
                    type="text" />
                </td>

                <td><input 
                    oninput="model.tasks[${index}].doneDate=this.value"
                    value="${tasks.doneDate}" 
                    type="text" /></td>

                <td><input 
                    oninput="model.tasks[${index}].responsible=this.value" 
                    value="${tasks.responsible}"
                    type="text">
                </td>
                `
      }
      else {
        html = /*HTML*/`
                    <td>${tasks.text}</td>
                    <td>${tasks.doneDate}</td>
                    <td>${tasks.responsible}</td>
                    `
      }
      return html;
    }


  </script>
</body>

</html>